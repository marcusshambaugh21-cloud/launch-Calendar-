<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>üöÄ Launch Calendar</title>

<style>
body {
  margin:0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background:#0b0f17;
  color:#e7ecf3;
}
header {
  padding:16px;
  border-bottom:1px solid #1b2333;
  position:sticky;
  top:0;
  background:#0b0f17;
}
h1 { margin:0 0 10px; font-size:18px; }
.controls {
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
button, input {
  background:#121a2a;
  color:#e7ecf3;
  border:1px solid #23304a;
  border-radius:10px;
  padding:10px 14px;
  cursor:pointer;
}
main { max-width:900px; margin:auto; padding:16px; }
.card {
  background:#0f1522;
  border:1px solid #1b2333;
  border-radius:14px;
  padding:14px;
  margin-bottom:12px;
}
.meta { opacity:.8; font-size:13px; line-height:1.4; }
.error { color:#ff8a8a; }
.muted { opacity:.6; }
</style>
</head>

<body>
<header>
  <h1>üöÄ Launch Calendar</h1>
  <div class="controls">
    <button onclick="loadDay(0)">Today</button>
    <button onclick="loadDay(1)">Tomorrow</button>
    <input type="date" id="picker">
    <button onclick="loadPicked()">Refresh</button>
    <span class="muted" id="updated"></span>
  </div>
</header>

<main id="content">
  Loading‚Ä¶
</main>

<script>
const API = "https://ll.thespacedevs.com/2.3.0/launches/";
const CACHE_MINUTES = 30;

function cacheKey(date) {
  return "launches_" + date;
}

function nowISO(d) {
  return new Date(d).toISOString();
}

async function fetchLaunches(date) {
  const key = cacheKey(date);
  const cached = localStorage.getItem(key);

  if (cached) {
    const data = JSON.parse(cached);
    const age = (Date.now() - data.time) / 60000;
    if (age < CACHE_MINUTES) return data.payload;
  }

  const start = new Date(date);
  start.setHours(0,0,0,0);
  const end = new Date(start);
  end.setDate(end.getDate() + 1);

  const url = `${API}?net__gte=${start.toISOString()}&net__lt=${end.toISOString()}&limit=20`;

  const res = await fetch(url);
  if (!res.ok) throw new Error(res.status);

  const json = await res.json();
  localStorage.setItem(key, JSON.stringify({
    time: Date.now(),
    payload: json.results
  }));
  return json.results;
}

function render(list, date) {
  const c = document.getElementById("content");
  c.innerHTML = "";

  if (!list.length) {
    c.innerHTML = `<p class="muted">No launches scheduled for ${date}.</p>`;
    return;
  }

  list.forEach(l => {
    const local = new Date(l.net).toLocaleString();
    c.innerHTML += `
      <div class="card">
        <strong>${l.rocket?.configuration?.name || "Unknown Rocket"}</strong>
        <div class="meta">
          üïí ${local}<br>
          üìç ${l.pad?.location?.name || "Unknown"}<br>
          üõ∞ ${l.mission?.name || "Unknown Mission"}<br>
          <a href="${l.url}" target="_blank">More info</a>
        </div>
      </div>`;
  });
}

async function load(dateStr) {
  document.getElementById("content").innerText = "Loading‚Ä¶";
  try {
    const launches = await fetchLaunches(dateStr);
    render(launches, dateStr);
    document.getElementById("updated").innerText =
      "Updated: " + new Date().toLocaleTimeString();
  } catch (e) {
    document.getElementById("content").innerHTML =
      `<p class="error">API rate limit hit. Cached data will resume shortly.</p>`;
  }
}

function loadDay(offset) {
  const d = new Date();
  d.setDate(d.getDate() + offset);
  load(d.toISOString().split("T")[0]);
}

function loadPicked() {
  const v = document.getElementById("picker").value;
  if (v) load(v);
}

loadDay(0);
</script>
</body>
</html>
